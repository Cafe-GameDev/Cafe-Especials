# Sugestões para a Versão 2.0 do CafeAudioManager

Este documento descreve sugestões de aprimoramentos e novos recursos para uma futura versão (v2.0) do plugin `CafeAudioManager`.

## 1. Sugestões de Recursos (Features)

### 1.1. Suporte a Áudio Posicional (2D/3D)

Atualmente, o `CafeAudioManager` é projetado exclusivamente para áudio mono, sem suporte para efeitos de áudio posicional. Para endereçar essa limitação, a versão 2.0 introduzirá os nós `CafeAudioPlayer2D` e `CafeAudioPlayer3D`, que atuarão como extensões posicionais do `CafeAudioManager`. Detalhes sobre esses nós podem ser encontrados na seção [1.4. Nós CafeAudioPlayer (2D/3D)](#14-nos-cafeaudioplayer-2d3d).

*   **Impacto nos Sinais:** Os sinais `play_sfx_requested` e `play_music_requested` serão estendidos para incluir um parâmetro `manager_node`, permitindo que o áudio seja gerenciado pelo `CafeAudioManager` central ou por uma instância específica de `CafeAudioPlayer2D/3D` para reprodução posicional.

### 1.2. Controle de Fade para Música

Implementar transições suaves (fade-in/fade-out) entre as faixas de música ou ao parar a música. Isso melhora significativamente a experiência auditiva do jogador, evitando cortes abruptos.

*   **Implementação:**
    *   Adicionar parâmetros opcionais aos sinais `play_music_requested` (ex: `fade_duration: float = 1.0`) para controlar a duração do fade-in.
    *   Introduzir uma nova função `stop_music_with_fade(fade_duration: float = 1.0)` para parar a música com um fade-out suave.
    *   Utilizar `Tween`s ou timers para gerenciar as transições de volume.

### 1.3. Controle de Loop para SFX

Adicionar a opção de reproduzir um SFX em loop, o que é útil para sons de ambiente, efeitos contínuos (ex: motor de carro, chuva) ou música de fundo curta que não é gerenciada pelo sistema de playlist de música.

*   **Implementação:**
    *   Um novo sinal, como `play_looping_sfx_requested(sfx_key: String, bus: String, loop: bool = true)` ou um parâmetro `loop: bool` no sinal `play_sfx_requested`.
    *   Uma forma de parar SFX específicos que estão em loop, como `stop_looping_sfx_requested(sfx_key: String)` ou `stop_sfx_by_player(player_node: Node)`.
    *   O pool de SFX precisaria ser capaz de rastrear quais players estão reproduzindo SFX em loop para que possam ser parados individualmente.

### 1.4. Nós CafeAudioPlayer (2D/3D)

Para estender as capacidades de áudio posicional do plugin, serão introduzidos os nós `CafeAudioPlayer2D` e `CafeAudioPlayer3D`. Estes nós atuarão como gerenciadores de áudio posicionais, sendo filhos de entidades no jogo (como o jogador ou inimigos) e permitindo que o áudio seja emitido de uma localização específica no mundo.

*   **Natureza do Nó:** Um `CafeAudioPlayer` será um nó de cena simples (não um `AudioStreamPlayer` diretamente) com um script dedicado, configurado para aparecer na lista de nós do Godot. Ele terá variações 2D e 3D para diferentes contextos de jogo.
*   **Gerenciamento Dinâmico de Filhos:** Cada `CafeAudioPlayer` será capaz de gerar dinamicamente instâncias de `AudioStreamPlayer2D` ou `AudioStreamPlayer3D` como seus filhos. Isso permite que múltiplos sons posicionais sejam reproduzidos simultaneamente a partir de uma única entidade (ex: passos e ataques de um personagem).
*   **Configurações Exportadas:** O `CafeAudioPlayer` exporá propriedades no editor para configurar o comportamento de reprodução, incluindo:
    *   **Modo de Repetição:** Ativar/desativar loop para sons contínuos (ex: passos).
    *   **Modo de Reprodução:** Definir se os sons devem ser reproduzidos aleatoriamente, em ordem (fila) ou sem repetição.
    *   **Quantidade Dinâmica:** Uma variável que, se marcada, permite que o nó gere dinamicamente novos `AudioStreamPlayer` filhos conforme necessário para gerenciar a reprodução simultânea de múltiplos áudios.
*   **Integração com CafeAudioManager:** O `CafeAudioPlayer` será uma extensão posicional do `CafeAudioManager`. Ele será gerenciado pelo manager principal, mas também administrará seus próprios áudios posicionais.
*   **Otimização de Memória:** Para economizar recursos, o `CafeAudioPlayer` removerá dinamicamente os nós `AudioStreamPlayer` filhos que não estiverem mais em uso, mantendo sempre pelo menos um para prontidão.
*   **Uso nos Sinais:** Ao emitir sinais de áudio (ex: `play_sfx_requested`), o novo parâmetro `manager_node` permitirá que o desenvolvedor especifique se o áudio deve ser reproduzido pelo `CafeAudioManager` central (passando `null` ou o próprio `CafeAudioManager`) ou por uma instância específica de `CafeAudioPlayer2D/3D` (passando a referência do nó `CafeAudioPlayer`). Isso permite flexibilidade entre áudio global e posicional.
    *   **Exemplo:** `CafeAudioManager.play_sfx_requested.emit("passos", "SFX", $Player/CafeAudioPlayer2D)`

### 1.2. Controle de Fade para Música

Implementar transições suaves (fade-in/fade-out) entre as faixas de música ou ao parar a música. Isso melhora significativamente a experiência auditiva do jogador, evitando cortes abruptos.

*   **Implementação:**
    *   Adicionar parâmetros opcionais aos sinais `play_music_requested` (ex: `fade_duration: float = 1.0`) para controlar a duração do fade-in.
    *   Introduzir uma nova função `stop_music_with_fade(fade_duration: float = 1.0)` para parar a música com um fade-out suave.
    *   Utilizar `Tween`s ou timers para gerenciar as transições de volume.

### 1.3. Controle de Loop para SFX

Adicionar a opção de reproduzir um SFX em loop, o que é útil para sons de ambiente, efeitos contínuos (ex: motor de carro, chuva) ou música de fundo curta que não é gerenciada pelo sistema de playlist de música.

*   **Implementação:**
    *   Um novo sinal, como `play_looping_sfx_requested(sfx_key: String, bus: String, loop: bool = true)`.
    *   Uma forma de parar SFX específicos que estão em loop, como `stop_looping_sfx_requested(sfx_key: String)`.
    *   O pool de SFX precisaria ser capaz de rastrear quais players estão reproduzindo SFX em loop para que possam ser parados individualmente.

## 2. Sugestões de Documentação/Recursos Adicionais

### 2.1. Cena de Exemplo (Demo Scene)

Criar uma cena Godot simples (`cafe_audio_manager_demo.tscn`) dentro da pasta `addons/CafeAudioManager/scenes/` para demonstrar o uso básico e avançado do plugin de forma interativa.

*   **Conteúdo da Cena:**
    *   Botões para reproduzir diferentes SFX (com e sem loop, se implementado).
    *   Botões para iniciar/parar diferentes faixas de música ou playlists.
    *   Sliders para alterar o volume dos buses Master, Música e SFX.
    *   Exemplos de áudio posicional (se implementado), com um personagem se movendo e sons seguindo-o.
    *   Um script de exemplo mostrando como se conectar aos sinais emitidos pelo `CafeAudioManager` (ex: `music_track_changed`).

### 2.2. Guia de Migração Detalhado

Desenvolver um guia de migração mais abrangente para desenvolvedores que estão atualizando de um sistema de áudio existente para o `CafeAudioManager`.

*   **Conteúdo do Guia:**
    *   Exemplos de código "antes e depois" para cenários comuns (ex: substituir `AudioStreamPlayer.play()` por `CafeAudioManager.play_sfx_requested.emit()`).
    *   Dicas para mapear estruturas de áudio antigas para o `AudioManifest`.
    *   Considerações sobre a transição de sistemas de eventos globais para o EventBus do `CafeAudioManager`.

### 2.3. Melhoria na Geração do `AudioManifest`

Automatizar ou simplificar o processo de geração do `AudioManifest.tres` para melhorar o fluxo de trabalho do desenvolvedor.

*   **Implementação:**
    *   **Botão no Editor:** Adicionar um botão na interface do editor Godot (talvez no Inspector do nó `CafeAudioManager` ou em um dock personalizado) que execute o script `generate_audio_manifest.gd` com um único clique.
    *   **Hook de Exportação:** Explorar a possibilidade de executar o script de geração do manifest automaticamente como um passo pré-exportação, garantindo que o manifest esteja sempre atualizado nas builds finais.
    *   **Monitoramento de Arquivos:** (Mais avançado) Implementar um sistema que monitore os diretórios `sfx_root_path` e `music_root_path` e sugira a regeneração do manifest quando novos arquivos de áudio forem adicionados, removidos ou renomeados.